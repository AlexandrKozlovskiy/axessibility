%%
%% This is file `axessibility.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% axessibility.dtx 
%% 
%% This is a generated file.
%% 
%% Copyright (C) 2018, 2019  by
%% Anna Capietto, Sandro Coriasco, Tiziana Armano,
%% Nadir Murru, Alice Ruighi, Eugenia Taranto,
%% Dragan Ahmetovic, Cristian Bernareggi, Michele Berra.
%% 
%% This work consists of the main source file axessibility.dtx
%% and the derived files
%%    axessibility.ins, axessibility.sty, axessibility.pdf, README,
%%    axessibilityExampleGoldenMean.tex
%% 
%% The Current Maintainer of this work is
%%                Sandro Coriasco
%% 
%% This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 License
%% http://creativecommons.org/licenses/by-nc/4.0/
%% 


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{axessibility}
\RequirePackage{tagpdf}
\tagpdfsetup{tabsorder=structure,uncompress,activate-all,interwordspace=true}
\tagpdfifpdftexT
 {
\pdfcompresslevel=0
  %set language / can also be done with hyperref
  \pdfcatalog{/Lang (en-US)}
  \usepackage[T1]{fontenc}
  \input glyphtounicode
  \pdfgentounicode=1
 }

\tagpdfifluatexT
 {
  %set language / can also be done with hyperref
  \pdfextension catalog{/Lang (en-US)}
  \RequirePackage{fontspec}
  \RequirePackage{luacode}
  \newfontface\zerowidthfont{freeserif}
\directlua{
pdf.setcompresslevel(0)
pdf.setmajorversion(2)
pdf.setminorversion(0)
}
}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{xstring}
\newtoks\@mltext
\newtoks\@mltexttmp
\newcommand{\auxiliaryspace}{ }

\makeatletter\long\def\wrapnew#1{
\tagstructbegin{tag=P,alttext-o=\detokenize\expandafter{#1},actualtext-o=\detokenize\expandafter{#1}}
 \tagmcbegin{tag=P,alttext-o=\detokenize\expandafter{#1},actualtext-o=\detokenize\expandafter{#1}}
 #1
 \tagmcend
\tagstructend
}
\makeatother

\makeatletter
\long\def\wrapml#1{
\def\@mltext{\detokenize\expandafter{#1}}
\def\@mltexttmp{}
\StrBehind[5]{\@mltext}{ }[\@mltexttmp]
\StrGobbleRight{\@mltexttmp}{1}[\@mltext]
%
\BeginAccSupp{method=escape,ActualText=\auxiliaryspace\@mltext}
 #1
\EndAccSupp{}%
}
\makeatother


\makeatletter
\let\begin@document=\document
\let\end@document=\enddocument
\renewcommand{\document}{\begin@document\tagstructbegin{tag=Document}}
\renewcommand{\enddocument}{\tagstructend\end@document}
\renewenvironment{equation}{%
 \incr@eqnum
  \mathdisplay@push
  \st@rredfalse \global\@eqnswtrue
 \mathdisplay{equation}%
  \collect@body\wrapnew\auxiliaryspace}{%
  \endmathdisplay{equation}%
  \mathdisplay@pop
  \ignorespacesafterend
}
\makeatother


\makeatletter
\renewenvironment{equation*}{%
  \mathdisplay@push
  \st@rredtrue \global\@eqnswfalse
  \mathdisplay{equation*}%
  \collect@body\wrapnew\auxiliaryspace}{%
  \endmathdisplay{equation*}%
  \mathdisplay@pop
  \ignorespacesafterend
}
\makeatother


\makeatletter
\protected\def\[#1\]{\begin{equation*}#1\end{equation*}}
\makeatother

\makeatletter
\newenvironment{tempenv}{%
  \relax\ifmmode\@badmath\else$\fi%
 \collect@body\wrapnew}{%
  \relax\ifmmode\ifinner$\else\@badmath\fi\else \@badmath\fi}
\protected\def\(#1\){\begin{tempenv}#1\end{tempenv}}
\makeatother


%\makeatletter
%
%\renewenvironment{alignat}{%
%  \collect@body\wrapml\auxiliaryspace
%  \start@align\z@\st@rredfalse
%}{%
%  \endalign
%}
%\renewenvironment{alignat*}{%
%  \collect@body\wrapml\auxiliaryspace
%  \start@align\z@\st@rredtrue
%}{%
%  \endalign
%}
%\renewenvironment{xalignat}{%
%  \collect@body\wrapml\auxiliaryspace
%  \start@align\@ne\st@rredfalse
%}{%
%  \endalign
%}
%\renewenvironment{xalignat*}{%
%  \collect@body\wrapml\auxiliaryspace
%  \start@align\@ne\st@rredtrue
%}{%
%  \endalign
%}
%\renewenvironment{xxalignat}{%
%  \collect@body\wrapml\auxiliaryspace
%  \start@align\tw@\st@rredtrue
%}{%
%  \endalign
%}
%
%\renewenvironment{align}{%
%  \collect@body\wrapml\auxiliaryspace
% \start@align\@ne\st@rredfalse\m@ne
%}{%
%  \math@cr \black@\totwidth@
%  \egroup
%  \ifingather@
%    \restorealignstate@
%    \egroup
%    \nonumber
%    \ifnum0=`{\fi\iffalse}\fi
%  \else
%    $$%
%  \fi
%  \ignorespacesafterend
%}
%
%\renewenvironment{align*}{%
%  \collect@body\wrapml\auxiliaryspace
%  \start@align\@ne\st@rredtrue\m@ne
%}{%
%  \endalign
%}
%
%\renewenvironment{flalign}{%
%  \collect@body\wrapml\auxiliaryspace
%  \start@align\tw@\st@rredfalse\m@ne
%}{%
%  \endalign
%}
%
%\renewenvironment{flalign*}{%
%  \collect@body\wrapml\auxiliaryspace
%  \start@align\tw@\st@rredtrue\m@ne
%}{%
%  \endalign
%}
%
%\renewenvironment{gather}{%
%  \collect@body\wrapml\auxiliaryspace\auxiliaryspace
%  \start@gather\st@rredfalse
%}{%
%  \math@cr \black@\totwidth@ \egroup
%  $$\ignorespacesafterend
%}
%
%\renewenvironment{gather*}{%
%  \collect@body\wrapml\auxiliaryspace\auxiliaryspace
%  \start@gather\st@rredtrue
%}{%
%  \endgather
%}
%
%%\renewenvironment{multline}{%
%%  \start@multline\st@rredfalse
%%}{%
%%  \iftagsleft@ \@xp\lendmultline@ \else \@xp\rendmultline@ \fi
%%  \ignorespacesafterend
%%}
%%%    \end{macrocode}
%%%
%%%    \begin{macrocode}
%%\renewenvironment{multline*}{\start@multline\st@rredtrue}{\endmultline}
%%
%%\renewenvironment{split}{%
%%  \if@display
%%    \ifinner
%%      \@xp\@xp\@xp\split@aligned
%%    \else
%%      \ifst@rred \else \global\@eqnswtrue \fi
%%    \fi
%%  \else \let\endsplit\@empty \@xp\collect@body\@xp\split@err
%%  \fi
%%  \collect@body\gather@split
%%}{%
%%      \crcr
%%    \egroup
%%  \egroup
%%  \iftagsleft@ \@xp\lendsplit@ \else \@xp\rendsplit@ \fi
%%}
%
%\makeatother


\endinput
%%
%% End of file `axessibility.sty'.
